<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Prepa Concour | Quiz Hub</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/styles.css" />
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <h1>Prepa Concour</h1>
        <nav aria-label="Primary">
          <ul class="nav">
            <li><a href="login.html">Login</a></li>
          </ul>
        </nav>
        <div class="auth-controls" style="display:none; margin-top: .5rem; display: flex; gap: .5rem; align-items: center; flex-wrap: wrap;">
          <span> Hello, <strong id="user-name">Guest</strong> </span>
          <button id="signin" class="btn" type="button">Sign in with Google</button>
          <button id="signout" class="btn" type="button" style="display:none;">Sign out</button>
        </div>
      </div>
    </header>

    <main class="container">
      <section>
        <h2>Welcome</h2>
        <p>Practice multiple-choice questions by subject or try a sampled full exam. All content loads dynamically.</p>
      </section>

      <section class="card-grid">
        <article class="card">
          <h3>Full Exam Practice</h3>
          <p>Attempt a mixed exam sampled from all subjects.</p>
          <a class="btn" href="exam.html">Start Exam</a>
        </article>
        <article class="card">
        <h3>Biology</h3>
          <p>Test your knowledge of key biology topics.</p>
          <a class="btn" href="biology.html">Start Biology</a>
        </article>
        <article class="card">
          <h3>Chemistry</h3>
          <p>Challenge yourself with foundational chemistry questions.</p>
          <a class="btn" href="chemistry.html">Start Chemistry</a>
        </article>
        <article class="card">
          <h3>Physics</h3>
          <p>Explore fundamental concepts in physics.</p>
          <a class="btn" href="physics.html">Start Physics</a>
        </article>
        <article class="card">
          <h3>General Knowledge</h3>
          <p>Broaden your horizons with general knowledge questions.</p>
          <a class="btn" href="general-knowledge.html">Start General Knowledge</a>
        </article>
        <article class="card">
          <h3>French</h3>
          <p>Practice comprehension and language skills in French.</p>
          <a class="btn" href="french.html">Start French</a>
        </article>
      </section>
    </main>

    <footer class="site-footer">
      <div class="container">
        <p>&copy; <span id="year"></span> Prepa Concour</p>
      </div>
    </footer>

    <script type="module" src="assets/js/firebase.js"></script>
<script>
  // Gate: redirect unauthenticated users to login page
  const gate = () => {
    if (!window.fb) return;
    const { auth, onAuthStateChanged } = window.fb;
    onAuthStateChanged(auth, (user) => {
      if (!user) window.location.href = 'login.html';
    });
  };
  if (window.fb) gate(); else window.addEventListener('firebase-ready', gate, { once: true });
</script>
<script>
  // Funnel signed-out users to login page when clicking "My Attempts"
  const setAttemptsLink = () => {
    const link = document.getElementById('nav-attempts') || document.querySelector('a[href="attempts.html"]');
    if (!link) return;
    const update = (user) => { link.setAttribute('href', user ? 'attempts.html' : 'login.html'); };
    if (!window.fb) { update(null); return; }
    const { auth, onAuthStateChanged } = window.fb;
    update(auth.currentUser);
    onAuthStateChanged(auth, update);
  };
  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', setAttemptsLink);
  else setAttemptsLink();
</script>
    <script>
      document.getElementById('year').textContent = new Date().getFullYear();
      // Wire auth UI if Firebase is available
      const updateAuthUI = (user) => {
        const nameEl = document.getElementById('user-name');
        const inBtn = document.getElementById('signin');
        const outBtn = document.getElementById('signout');
        if (!nameEl || !inBtn || !outBtn) return;
        if (user) {
          nameEl.textContent = user.displayName || user.email || 'User';
          inBtn.style.display = 'none';
          outBtn.style.display = '';
        } else {
          nameEl.textContent = 'Guest';
          inBtn.style.display = '';
          outBtn.style.display = 'none';
        }
      };

      const bootAuth = () => {
        if (!window.fb) return;
        const { auth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } = window.fb;
        onAuthStateChanged(auth, (user) => updateAuthUI(user));
        const inBtn = document.getElementById('signin');
        const outBtn = document.getElementById('signout');
        if (inBtn) inBtn.onclick = async () => {
          try { await signInWithPopup(auth, new GoogleAuthProvider()); }
          catch (e) { console.warn('Sign-in failed', e); }
        };
        if (outBtn) outBtn.onclick = () => signOut(auth);
      };

      if (window.fb) bootAuth();
      else window.addEventListener('firebase-ready', bootAuth, { once: true });
    </script>
  </body>
</html>
